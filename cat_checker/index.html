<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cat Alert Status</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* â”€â”€ Theme variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
      --bg:          #fdf6ee;
      --bg-card:     #ffffff;
      --bg-thead:    #f5ebe0;
      --bg-hover:    #fdf0e5;
      --bg-pill:     #fff3e8;
      --bg-email:    #fff3e8;
      --bg-config:   #ffffff;
      --border:      #f0e0d0;
      --border-pill: #f5d5b8;
      --border-row:  #f0e8df;
      --text:        #333333;
      --text-muted:  #777777;
      --text-sub:    #aaaaaa;
      --text-label:  #999999;
      --text-sep:    #dddddd;
      --text-th:     #666666;
      --accent:      #c0550a;
      --accent-blue: #2563eb;
      --accent-green:#2e8b57;
      --shadow:      rgba(0,0,0,.07);
      --badge-alert-bg: #fde8d0;
      --badge-quiet-bg: #e8f5ee;
      --badge-zero-bg:  #eeeeee;
      --badge-zero-text:#999999;
      --section-border: #f0e0d0;
    }

    [data-theme="dark"] {
      --bg:          #1a1a1a;
      --bg-card:     #252525;
      --bg-thead:    #2e2e2e;
      --bg-hover:    #2a2a2a;
      --bg-pill:     #2e2218;
      --bg-email:    #2e2218;
      --bg-config:   #252525;
      --border:      #3a3a3a;
      --border-pill: #4a3020;
      --border-row:  #333333;
      --text:        #e0e0e0;
      --text-muted:  #aaaaaa;
      --text-sub:    #888888;
      --text-label:  #888888;
      --text-sep:    #444444;
      --text-th:     #aaaaaa;
      --accent:      #e07b39;
      --accent-blue: #4a90d9;
      --accent-green:#3aad6e;
      --shadow:      rgba(0,0,0,.3);
      --badge-alert-bg: #3d2010;
      --badge-quiet-bg: #0e2a1a;
      --badge-zero-bg:  #2a2a2a;
      --badge-zero-text:#888888;
      --section-border: #3a3a3a;
    }

    /* â”€â”€ Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 2rem 1rem;
      transition: background .2s, color .2s;
    }

    a { color: var(--accent); }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      text-align: center;
      margin-bottom: 1.5rem;
      position: relative;
    }
    header h1 { font-size: 2rem; color: var(--accent); }
    header p  { color: var(--text-muted); margin-top: .3rem; font-size: .95rem; }

    /* â”€â”€ Dark-mode toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #theme-toggle {
      position: absolute;
      top: 0;
      right: 0;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: .4rem .75rem;
      font-size: .85rem;
      cursor: pointer;
      color: var(--text);
      transition: background .2s, border-color .2s;
    }
    #theme-toggle:hover { border-color: var(--accent); }

    /* â”€â”€ Paused banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #paused-banner {
      display: none;
      background: #7f1d1d;
      color: #fecaca;
      border-radius: 10px;
      padding: .75rem 1.25rem;
      margin-bottom: 1.5rem;
      font-weight: 600;
      text-align: center;
      font-size: .95rem;
      letter-spacing: .02em;
    }
    #paused-banner.visible { display: block; }

    /* â”€â”€ Control buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .controls {
      display: flex;
      gap: .75rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 2rem;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: .45rem;
      padding: .6rem 1.3rem;
      border-radius: 10px;
      font-size: .92rem;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      border: none;
      transition: filter .15s, transform .1s;
    }
    .btn:hover  { filter: brightness(1.12); transform: translateY(-1px); }
    .btn:active { transform: translateY(0); filter: brightness(.95); }

    .btn-stop {
      background: #dc2626;
      color: #fff;
    }
    .btn-resume {
      background: var(--accent-green);
      color: #fff;
    }
    .btn-check {
      background: var(--accent-blue);
      color: #fff;
    }

    /* â”€â”€ Summary cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .cards {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 2rem;
    }
    .card {
      background: var(--bg-card);
      border-radius: 12px;
      box-shadow: 0 2px 8px var(--shadow);
      padding: 1.25rem 1.75rem;
      min-width: 180px;
      text-align: center;
      transition: background .2s;
    }
    .card .label { font-size: .78rem; text-transform: uppercase; letter-spacing: .05em; color: var(--text-label); }
    .card .value { font-size: 1.6rem; font-weight: 700; color: var(--accent); margin-top: .2rem; }
    .card .sub   { font-size: .8rem; color: var(--text-sub); margin-top: .15rem; }

    .card.green .value { color: var(--accent-green); }
    .card.blue  .value { color: var(--accent-blue); }

    /* â”€â”€ Section title â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .section-title {
      font-size: 1.05rem;
      font-weight: 600;
      color: var(--text-muted);
      margin-bottom: .75rem;
      border-bottom: 2px solid var(--section-border);
      padding-bottom: .4rem;
    }

    /* â”€â”€ Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--bg-card);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px var(--shadow);
      font-size: .9rem;
      transition: background .2s;
    }
    thead th {
      background: var(--bg-thead);
      color: var(--text-th);
      font-weight: 600;
      padding: .7rem 1rem;
      text-align: left;
      font-size: .78rem;
      text-transform: uppercase;
      letter-spacing: .04em;
    }
    tbody tr { border-top: 1px solid var(--border-row); }
    tbody tr:hover { background: var(--bg-hover); }
    tbody td { padding: .65rem 1rem; vertical-align: top; }

    /* â”€â”€ Badges â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .badge {
      display: inline-block;
      padding: .2rem .55rem;
      border-radius: 999px;
      font-size: .75rem;
      font-weight: 600;
    }
    .badge-alert { background: var(--badge-alert-bg); color: var(--accent); }
    .badge-quiet { background: var(--badge-quiet-bg); color: var(--accent-green); }
    .badge-zero  { background: var(--badge-zero-bg);  color: var(--badge-zero-text); }

    /* â”€â”€ Cat pills â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .cat-pill {
      display: inline-block;
      background: var(--bg-pill);
      border: 1px solid var(--border-pill);
      border-radius: 8px;
      padding: .2rem .6rem;
      font-size: .82rem;
      margin: .1rem .15rem .1rem 0;
    }
    .cat-pill a { color: var(--accent); text-decoration: none; }
    .cat-pill a:hover { text-decoration: underline; }

    /* â”€â”€ Config strip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .countdown { font-variant-numeric: tabular-nums; }

    .config-strip {
      background: var(--bg-config);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: .75rem 1.25rem;
      margin-bottom: 1.5rem;
      font-size: .88rem;
      color: var(--text);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: .4rem;
      transition: background .2s;
    }
    .config-label { color: var(--text-label); font-size: .78rem; text-transform: uppercase; letter-spacing: .04em; }
    .config-sep   { color: var(--text-sep); }
    .config-edit  { margin-left: auto; color: var(--accent); text-decoration: none; font-size: .8rem; }
    .config-edit:hover { text-decoration: underline; }
    .email-tag {
      background: var(--bg-email);
      border: 1px solid var(--border-pill);
      border-radius: 6px;
      padding: .1rem .5rem;
      font-size: .83rem;
      font-family: monospace;
    }

    /* â”€â”€ Misc â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--text-sub);
      font-size: .95rem;
    }

    .wrapper { max-width: 900px; margin: 0 auto; }
    .table-wrapper { margin-bottom: 2rem; }

    .ts-rel { color: var(--text-sub); font-size: .8rem; }
    .ts-abs { font-size: .88rem; }

    #status-bar {
      text-align: center;
      font-size: .8rem;
      color: var(--text-sub);
      margin-top: 2rem;
    }
    #status-bar code {
      background: var(--bg-card);
      padding: .1rem .35rem;
      border-radius: 4px;
      font-size: .78rem;
    }
  </style>
</head>
<body>
<div class="wrapper">

  <header>
    <h1>ğŸ± Cat Alert Status</h1>
    <p>Monitoring <a href="https://www.arthuranimalrescue.com/adoptables" target="_blank">Arthur Animal Rescue</a> every 15 minutes for cats â‰¤ 12 months</p>
    <button id="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">ğŸŒ™ Dark</button>
  </header>

  <!-- Paused warning banner -->
  <div id="paused-banner">â›” Alerts are PAUSED â€” no emails will be sent until resumed.</div>

  <!-- Control buttons -->
  <div class="controls">
    <a class="btn btn-stop"
       href="https://github.com/Vashtag/CE/actions/workflows/emergency_stop.yml"
       target="_blank"
       title="Opens GitHub Actions to run the Emergency Stop workflow">
      ğŸ›‘ Emergency Stop
    </a>
    <a class="btn btn-resume"
       href="https://github.com/Vashtag/CE/actions/workflows/resume_alerts.yml"
       target="_blank"
       title="Opens GitHub Actions to resume alerts">
      â–¶ Resume Alerts
    </a>
    <a class="btn btn-check"
       href="https://github.com/Vashtag/CE/actions/workflows/cat_alert.yml"
       target="_blank"
       title="Opens GitHub Actions to run a check now">
      ğŸ” Run Check Now
    </a>
  </div>

  <!-- Summary cards -->
  <div class="cards">
    <div class="card" id="card-last">
      <div class="label">Last Check</div>
      <div class="value" id="val-last">â€”</div>
      <div class="sub" id="sub-last">â€”</div>
    </div>
    <div class="card" id="card-next">
      <div class="label">Next Check In</div>
      <div class="value countdown" id="val-next">â€”</div>
      <div class="sub">approx.</div>
    </div>
    <div class="card blue" id="card-total">
      <div class="label">Total Checks</div>
      <div class="value" id="val-total">â€”</div>
      <div class="sub">since tracking started</div>
    </div>
    <div class="card green" id="card-alerts">
      <div class="label">Alerts Sent</div>
      <div class="value" id="val-alerts">â€”</div>
      <div class="sub">total emails sent</div>
    </div>
  </div>

  <!-- Config strip -->
  <div class="config-strip" id="config-strip">
    <span class="config-label">Notifying:</span>
    <span id="cfg-emails">loadingâ€¦</span>
    <span class="config-sep">Â·</span>
    <span class="config-label">Age limit:</span>
    <span id="cfg-age">â€”</span>
    <span class="config-sep">Â·</span>
    <span class="config-label">Interval:</span>
    <span id="cfg-interval">â€”</span>
    <span class="config-sep">Â·</span>
    <a href="https://github.com/Vashtag/CE/blob/main/cat_checker/config.json" target="_blank" class="config-edit">edit config.json â†—</a>
  </div>

  <!-- Recent checks table -->
  <div class="table-wrapper">
    <div class="section-title">Recent Checks (newest first)</div>
    <div id="table-container">
      <div class="empty-state">Loadingâ€¦</div>
    </div>
  </div>

  <div id="status-bar">Auto-refreshes every 60 seconds &nbsp;Â·&nbsp; Data from <code>check_log.json</code></div>

</div>

<script>
  const CHECK_INTERVAL_MS = 15 * 60 * 1000;

  /* â”€â”€ Dark mode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function applyTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    const btn = document.getElementById('theme-toggle');
    btn.textContent = theme === 'dark' ? 'â˜€ï¸ Light' : 'ğŸŒ™ Dark';
  }

  function toggleTheme() {
    const current = document.documentElement.getAttribute('data-theme');
    const next = current === 'dark' ? 'light' : 'dark';
    applyTheme(next);
    localStorage.setItem('cat-alert-theme', next);
  }

  // Restore saved preference on load
  applyTheme(localStorage.getItem('cat-alert-theme') || 'light');

  /* â”€â”€ Formatting helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function fmtRelative(isoStr) {
    const diff = Math.round((Date.now() - new Date(isoStr)) / 1000);
    if (diff <  90)  return `${diff}s ago`;
    if (diff < 3600) return `${Math.round(diff / 60)}m ago`;
    if (diff < 86400)return `${Math.round(diff / 3600)}h ago`;
    return `${Math.round(diff / 86400)}d ago`;
  }

  function fmtAbs(isoStr) {
    return new Date(isoStr).toLocaleString(undefined, {
      month: 'short', day: 'numeric',
      hour: '2-digit', minute: '2-digit',
    });
  }

  function fmtCountdown(ms) {
    if (ms <= 0) return 'any moment';
    const s = Math.round(ms / 1000);
    if (s < 60) return `${s}s`;
    return `${Math.floor(s / 60)}m ${s % 60}s`;
  }

  /* â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  let lastTimestamp = null;

  function updateCountdown() {
    if (!lastTimestamp) return;
    const elapsed = Date.now() - new Date(lastTimestamp);
    const remaining = CHECK_INTERVAL_MS - elapsed;
    document.getElementById('val-next').textContent = fmtCountdown(remaining);
  }

  /* â”€â”€ Render log â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function render(log) {
    const entries = [...log].reverse();
    lastTimestamp = entries.length ? entries[0].timestamp : null;

    const totalAlerts = log.reduce((s, e) => s + e.alerts_sent, 0);
    document.getElementById('val-total').textContent  = log.length;
    document.getElementById('val-alerts').textContent = totalAlerts;

    if (lastTimestamp) {
      document.getElementById('val-last').textContent = fmtRelative(lastTimestamp);
      document.getElementById('sub-last').textContent = fmtAbs(lastTimestamp);
      updateCountdown();
    }

    if (!entries.length) {
      document.getElementById('table-container').innerHTML =
        '<div class="empty-state">No checks recorded yet â€” the first run will appear here once the workflow runs.</div>';
      return;
    }

    const rows = entries.map(e => {
      const hasAlerts = e.alerts_sent > 0;
      const noCats    = e.total_on_page === 0;
      const paused    = e.paused === true;

      const badge = paused
        ? `<span class="badge badge-zero">â›” paused</span>`
        : hasAlerts
          ? `<span class="badge badge-alert">ğŸ”” ${e.alerts_sent} alert${e.alerts_sent > 1 ? 's' : ''}</span>`
          : noCats
            ? `<span class="badge badge-zero">âš ï¸ 0 cats</span>`
            : `<span class="badge badge-quiet">âœ“ quiet</span>`;

      const catPills = (e.alerted_cats || []).map(c => {
        const age = c.age_months != null ? `${c.age_months}mo` : '?';
        return `<span class="cat-pill"><a href="${c.url}" target="_blank">${c.name}</a> <small>${age}</small></span>`;
      }).join('');

      return `
        <tr>
          <td>
            <div class="ts-abs">${fmtAbs(e.timestamp)}</div>
            <div class="ts-rel">${fmtRelative(e.timestamp)}</div>
          </td>
          <td>${e.total_on_page}</td>
          <td>${badge}${catPills ? '<br><div style="margin-top:.4rem">' + catPills + '</div>' : ''}</td>
        </tr>`;
    }).join('');

    document.getElementById('table-container').innerHTML = `
      <table>
        <thead>
          <tr>
            <th>Time (UTC local)</th>
            <th>Cats on page</th>
            <th>Result</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>`;
  }

  /* â”€â”€ Render config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function renderConfig(cfg) {
    const emails = cfg.notify_emails || [];
    document.getElementById('cfg-emails').innerHTML = emails.length
      ? emails.map(e => `<span class="email-tag">${e}</span>`).join(' ')
      : '<em style="color:var(--text-sub)">not set</em>';
    document.getElementById('cfg-age').textContent =
      `â‰¤ ${cfg.max_age_months ?? 12} months`;
    document.getElementById('cfg-interval').textContent =
      `every ${cfg.check_interval_minutes ?? 15} min`;

    // Show/hide paused banner
    const banner = document.getElementById('paused-banner');
    if (cfg.paused === true) {
      banner.classList.add('visible');
    } else {
      banner.classList.remove('visible');
    }
  }

  /* â”€â”€ Load data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  async function load() {
    const t = Date.now();
    const [logRes, cfgRes] = await Promise.allSettled([
      fetch('./check_log.json?t=' + t),
      fetch('./config.json?t=' + t),
    ]);

    if (logRes.status === 'fulfilled' && logRes.value.ok) {
      render(await logRes.value.json());
    } else {
      document.getElementById('table-container').innerHTML =
        `<div class="empty-state">Could not load check_log.json.<br>Make sure this page is served over HTTP/HTTPS, not opened as a local file.</div>`;
    }

    if (cfgRes.status === 'fulfilled' && cfgRes.value.ok) {
      renderConfig(await cfgRes.value.json());
    }
  }

  load();
  setInterval(load, 60_000);
  setInterval(updateCountdown, 1_000);
</script>
</body>
</html>
